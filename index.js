const axios = require('axios');

const analyzeEmails = require('./analyzeEmails'); 

const apiKey = process.env.VIRUSTOTAL_API_KEY



const mailDir = 'C:\\Users\\User\\Desktop\\PI\\mails'; // Remplacez par le chemin de votre dossier

// Appelez la fonction analyzeEmails() en lui passant le chemin du dossier
analyzeEmails(mailDir)

.then(results => {
        console.log(results)
        // Iterer sur les rÃ©sultats pour chaque fichier
        results.forEach(data => {
          const analysisId = data.id;
    
          axios.get(`https://www.virustotal.com/api/v3/analyses/${analysisId}`, {
            headers: {
              'x-apikey': apiKey,
            },
          })
          .then(response => {
            const res = response.data;
            console.log("/////////////////////////////////////////////////////////////////////")
            console.log("Voici le resultat pour l'element : " + data.fileName);
            console.log("/////////////////////////////////////////////////////////////////////")

            const resultOfAnalyses = res.data.attributes.results;
            for (const subObjetName in resultOfAnalyses) {
              if (resultOfAnalyses.hasOwnProperty(subObjetName)) {
                const subObjet = resultOfAnalyses[subObjetName];
                const category = subObjet.category;
                console.log(`Nom de l'outil d'analyse : ${subObjetName}, Category : ${category}`);
              }
            }
        })
            
          .catch(error => {
            console.error(error);
          });
        });
      })
  .catch(err => {
    console.error('Erreur lors de l\'analyse:', err);
  });





